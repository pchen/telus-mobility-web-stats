"use strict";angular.module("infographicApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("infographicApp").controller("MainCtrl",["$scope","$http",function(a,b){a.displayGrouped=!1,a.mobileDevices=[],a.mobileDevicesAll=[],a.mobileDevicesGrouped=[],a.mobileDevicesGroupedLength=0,a.mobileDevicesFlatGroup=[],a.smallestResolutionDevices={},a.highestResolutionDevices={},a.mostCommonResolutionDevices={},b.get("/data/mobileDevices.json").then(function(b){a.mobileDevicesAll=b.data,console.log("json length: ",a.mobileDevicesAll.length),a.mobileDevicesAll=_.filter(a.mobileDevicesAll,function(a){return 0!==a.pxWidth&&0!==a.pxHeight}),a.sortByWidth(a.mobileDevicesAll),a.groupDevicesBySize(),console.log("$scope.mobileDevicesAll: ",a.mobileDevicesAll),a.updateVis()}),a.updateVis=function(){a.mobileDevices=a.displayGrouped?a.mobileDevicesFlatGroup:a.mobileDevicesAll},a.countDevices=function(b){var b=b||a.displayGrouped;return b?a.mobileDevicesFlatGroup.length:a.mobileDevicesAll.length},a.sortByWidth=function(a){a.sort(function(a,b){return a.pxWidth>b.pxWidth?-1:a.pxWidth<b.pxWidth?1:0})},a.groupDevicesBySize=function(){if(!(a.mobileDevicesGrouped.length>0)){var b,c,d=[];a.mobileDevicesFlatGroup=[],a.mobileDevicesGroupedLength=0,a.smallestResolutionDevices=null,a.highestResolutionDevices=null,a.mostCommonResolutionDevices=null,d=_.groupBy(a.mobileDevicesAll,function(a){return a.pxWidth});for(b in d){var e=_.groupBy(d[b],function(a){return a.pxHeight});a.mobileDevicesGrouped[b]=[];for(c in e){if(void 0===a.mobileDevicesGrouped[b][c]){a.mobileDevicesGrouped[b][c]=[],a.mobileDevicesGroupedLength++,a.smallestResolutionDevices||(a.smallestResolutionDevices=e[c]);var f=_.pluck(e[c],"deviceName"),g={deviceName:f.join(", "),pxWidth:parseInt(b,10),pxHeight:parseInt(c,10),count:f.length,isPhone:!0};a.mobileDevicesFlatGroup.push(g)}a.mobileDevicesGrouped[b][c]=e[c]}a.highestResolutionDevices=e[c]}a.mostCommonResolutionDevices=_.max(a.mobileDevicesFlatGroup,function(a){return a.count}),a.sortByWidth(a.mobileDevicesFlatGroup),console.log("mobileDevicesGroupedLength: ",a.mobileDevicesGroupedLength),console.log("mobileDevicesGrouped: ",a.mobileDevicesGrouped),console.log("mobileDevicesFlatGroup: ",a.mobileDevicesFlatGroup),console.log("mostCommonResolutionDevices: ",a.mostCommonResolutionDevices),console.log("[320][480]: ",a.mobileDevicesGrouped[320][480]),console.log("[1024][600]: ",a.mobileDevicesGrouped[1024][600])}},a.getDeviceProperty=function(b,c){var b=b||"",c=c||"min";if(void 0===_[c])return void 0;var d=_[c].call(a,a.mobileDevicesAll,function(a){return a[b]});return d[b]},a.getDeviceNamesinArray=function(b){var c=_.pluck(a[b],"deviceName").toString();return c}}]),angular.module("infographicApp").directive("telusResolutionVis",function(){return{restrict:"E",replace:!0,template:'<div class="resolution-vis" style="width:{{visWidth}}px;height:{{visHeight}}px;">  <div id="tooltip" class="tooltip">    <h3>{{tooltipDevice.pxWidth}} x {{tooltipDevice.pxHeight}}:</h3>    <p>{{tooltipDevice.deviceName}}</p>  </div>  <div>    <telus-resolution-card ng-repeat="device in mobileDevices" device="device" order="$index" />  </div></div>',scope:!0,controller:["$scope",function(a){a.numCards=0,a.maxCardHeight=0,a.visHeight=0,a.visWidth=0,a.cardScale=.2,a.cardLeftMargin=10,a.cardTopMargin=0,a.selectedCard=[],a.selectedOrder,a.cardsDeactivated=!1,a.previousMouseEvent=null,a.tooltipDevice,a.getScaledUnit=function(b){return Math.round(b*a.cardScale)},a.getTopPositionForCard=function(b){return a.getScaledUnit(a.maxCardHeight-b)},a.getLeftPositionForCard=function(b){return(a.numCards-b)*a.cardLeftMargin},a.resetAllCardLeftPositions=function(){$(".resolution-card").each(function(b,c){var d=angular.element(c).scope().order;$(c).css("left",a.getLeftPositionForCard(d))})},a.resetSelectedCard=function(b){return a.selectedCard&&a.selectedCard.length>0&&(a.selectedCard.removeClass("selected"),a.selectedOrder=null,a.resetAllCardLeftPositions()),b?(a.selectedOrder=angular.element(b).scope().order,b):void 0},a.setAllPointerInteractions=function(b){a.cardsDeactivated="none"===b?!0:!1,$(".resolution-card").each(function(a,c){angular.element(c).scope().order,$(c).css("pointer-events",b)})},a.getVisHeight=function(){return a.visHeight}}],link:function(a,b){var c=b.offset().left-20,d=b.offset().top;b.on("click",".resolution-card",function(b){var e=b.target;a.selectedCard=a.resetSelectedCard($(e)).addClass("selected");var f,g=a.selectedCard.next(e)[0];if(g){var h=a.getLeftPositionForCard(angular.element(g).scope().order);f=h+g.offsetWidth+a.cardLeftMargin}else f=0;$(e).css("left",f);var i=f+e.offsetWidth,j=$(b.target).prevUntil(b.target);j.each(function(b,c){var d=(b+1)*a.cardLeftMargin;$(c).css("left",i+d)});var k=angular.element(b.target).scope().device;a.$apply(function(){a.tooltipDevice=k}),$("#tooltip").css({left:b.pageX-c,top:b.pageY-d,display:"none"})}),b.on("mouseenter",".resolution-card",function(b){var c=angular.element(b.target).scope().device;a.$apply(function(){a.tooltipDevice=c})}),b.on("mousemove",function(a){if(-1===a.target.className.indexOf("resolution-card"))$("#tooltip").removeAttr("style");else{if(a.target.className.indexOf("selected")>-1)return;$("#tooltip").css({left:a.pageX-c,top:a.pageY-d,display:"block"})}}),$(document).on("keydown",function(b){if(a.selectedCard&&a.selectedCard.length>0){var c;if(37===b.which?c=a.selectedCard.next(a.selectedCard)[0]:39===b.which&&(c=a.selectedCard.prev(a.selectedCard)[0]),c){a.setAllPointerInteractions("none");var d=$(a.selectedCard);d.css({cursor:"none"}),a.resetSelectedCard(c),$(c).trigger("click"),d.css({cursor:"pointer"})}}}),$(document).on("mousemove",function(b){if(a.cardsDeactivated){if(!a.previousMouseEvent)return a.previousMouseEvent=b,void 0;(b.pageX!==a.previousMouseEvent.pageX||b.pageY!==a.previousMouseEvent.pageY)&&(a.setAllPointerInteractions("auto"),a.previousMouseEvent=null)}}),a.$watch("mobileDevices",function(){0!==a.mobileDevices.length&&(a.maxCardHeight=a.$parent.getDeviceProperty("pxHeight","max"),a.numCards=a.$parent.countDevices(),a.visHeight=a.getScaledUnit(a.maxCardHeight)+a.cardTopMargin,a.visWidth=a.getLeftPositionForCard(0)+a.getScaledUnit(a.mobileDevices[0].pxWidth))})}}}),angular.module("infographicApp").directive("telusResolutionCard",function(){return{restrict:"E",replace:!0,template:'<div class="resolution-card">  <div class="resolution-title">    {{device.pxWidth}}    <span class="res-divider">x</span>    {{device.pxHeight}}    <span class="count" ng-show="device.count">({{device.count}})</span>  </div>  <div class="device-names">{{getDeviceName()}}</div></div>',require:"^telusResolutionVis",scope:{device:"=",order:"="},controller:["$scope","$element","$attrs",function(a){a.getDeviceName=function(){return a.device.deviceAlias||a.device.deviceName}}],link:function(a,b){if(0!==a.device.pxWidth||0!==a.device.pxHeight){var c=a.$parent.countDevices();a.$watch("",function(){var d=a.$parent.getVisHeight(),e=a.$parent.getTopPositionForCard(a.device.pxHeight),f=a.$parent.getScaledUnit(a.device.pxWidth),g=a.$parent.getScaledUnit(a.device.pxHeight),h=a.$parent.getLeftPositionForCard(a.order);b.css({width:f+"px",height:g+"px",left:h+"px",top:d+"px",opacity:0}),setTimeout(function(){b.css({top:e+"px",opacity:1})},30*(c-a.order));var i=b.children();i.height()>15&&b.find(".res-divider").addClass("multiline"),a.device.isPhone?b.addClass("phone"):b.addClass("tablet")})}}}});